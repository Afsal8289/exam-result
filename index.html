<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="google-adsense-account" content="ca-pub-8490206815383590">
  <title>Madrasa Exam Result</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" href="data:,">
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8490206815383590" crossorigin="anonymous"></script>

  <style>
    /* --- Modern UI Styles --- */
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap');

    body {
      margin: 0;
      font-family: 'Poppins', Arial, sans-serif;
      background: linear-gradient(135deg, #fdfbfb 0%, #ebedee 100%);
      color: #333;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }
    .main-wrapper {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    .card {
      width: 100%;
      max-width: 420px;
      background: #fff;
      padding: 30px 25px;
      border-radius: 24px;
      box-shadow: 0 15px 35px rgba(0,0,0,0.08);
      position: relative;
      overflow: hidden;
    }
    /* Top Accent Line */
    .card::before {
      content: '';
      position: absolute;
      top: 0; left: 0; width: 100%; height: 6px;
      background: linear-gradient(90deg, #007bff, #00c6ff);
    }
    .header-text {
      text-align: center;
      margin-bottom: 25px;
    }
    h2 {
      margin: 0;
      font-size: 22px;
      color: #1e293b;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .subtitle {
      display: block;
      font-size: 13px;
      color: #64748b;
      margin-top: 5px;
    }
    .input-group {
      margin-bottom: 18px;
      position: relative;
    }
    .input-group label {
      display: block;
      font-size: 13px;
      font-weight: 600;
      color: #475569;
      margin-bottom: 8px;
    }
    .input-wrapper {
      position: relative;
    }
    .input-wrapper i {
      position: absolute;
      left: 14px;
      top: 50%;
      transform: translateY(-50%);
      color: #94a3b8;
      font-size: 16px;
    }
    input, select {
      width: 100%;
      padding: 14px 14px 14px 42px;
      border-radius: 12px;
      border: 1px solid #cbd5e1;
      background: #f8fafc;
      font-size: 14px;
      font-family: inherit;
      color: #334155;
      box-sizing: border-box;
      transition: all 0.3s ease;
      appearance: none; /* Removes default select arrow for custom styling */
    }
    /* Custom Select Arrow */
    select {
      background-image: url("data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%2394a3b8%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.4-12.8z%22%2F%3E%3C%2Fsvg%3E");
      background-repeat: no-repeat;
      background-position: right 15px top 50%;
      background-size: 12px auto;
    }
    input:focus, select:focus {
      outline: none;
      border-color: #007bff;
      background: #fff;
      box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
    }
    .btn-group {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-top: 25px;
    }
    button {
      width: 100%;
      padding: 14px;
      border: none;
      border-radius: 12px;
      font-size: 15px;
      font-weight: 600;
      font-family: inherit;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      transition: all 0.2s;
    }
    button:active { transform: scale(0.98); }
    .view {
      background: #007bff;
      color: #fff;
      box-shadow: 0 4px 12px rgba(0, 123, 255, 0.25);
    }
    .view:hover { background: #0069d9; }
    .admin {
      background: #e2e8f0;
      color: #475569;
    }
    .admin:hover { background: #cbd5e1; }
    
    .footer {
      text-align: center;
      padding: 20px;
      font-size: 13px;
      color: #64748b;
    }
    .footer a {
      color: #64748b;
      text-decoration: none;
      margin: 0 5px;
      transition: color 0.2s;
    }
    .footer a:hover { color: #007bff; }
    
    #loaderText { color: #f59e0b; font-size: 12px; font-weight: 500; margin-top: 5px; display: none; }
  </style>
</head>

<body>

<div class="main-wrapper">
  <div class="card">
    <div class="header-text">
      <h2 id="mname">Madrasa Exam Result</h2>
      <span class="subtitle">Student Result Portal</span>
    </div>

    <div class="input-group">
      <label>Madrasa ID</label>
      <div class="input-wrapper">
        <i class="fas fa-id-badge"></i>
        <input id="mid" placeholder="Enter Madrasa ID" autocomplete="off">
      </div>
      <div id="loaderText"><i class="fas fa-spinner fa-spin"></i> Fetching details...</div>
    </div>

    <div class="input-group">
      <label>Class / Division</label>
      <div class="input-wrapper">
        <i class="fas fa-chalkboard-user"></i>
        <select id="cls">
          <option value="">Enter Madrasa ID first...</option>
        </select>
      </div>
    </div>

    <div class="input-group">
      <label>Register Number</label>
      <div class="input-wrapper">
        <i class="fas fa-hashtag"></i>
        <input id="reg" placeholder="Enter Register No" style="text-transform:uppercase" autocomplete="off">
      </div>
    </div>

    <div class="btn-group">
      <button class="view" id="viewBtn"><i class="fas fa-search"></i> View Result</button>
      <button class="admin" id="adminBtn"><i class="fas fa-user-shield"></i> Admin Login</button>
    </div>

  </div>
</div>

<div class="footer">
  <a href="about.html">About Us</a> |
  <a href="privacy.html">Privacy Policy</a> |
  <a href="terms.html">Terms</a> |
  <a href="contact.html">Contact</a>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
  import { getFirestore, doc, getDoc, collection, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDyyTKs5JVvTScGO3vdfOJBX7DCjv-M8ZQ",
    authDomain: "madrasa-exam-result.firebaseapp.com",
    projectId: "madrasa-exam-result",
    storageBucket: "madrasa-exam-result.firebasestorage.app",
    messagingSenderId: "852087187745",
    appId: "1:852087187745:web:657b0a8ffb23b44663b660"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const midInput = document.getElementById("mid");
  const clsSelect = document.getElementById("cls");
  const mnameTitle = document.getElementById("mname");
  const loaderText = document.getElementById("loaderText");

  // Fetch Madrasa Name & Classes when user types ID and clicks outside
  midInput.addEventListener("blur", async function() {
    const mid = midInput.value.trim();
    if(mid === ""){
      mnameTitle.innerText = "Madrasa Exam Result";
      clsSelect.innerHTML = `<option value="">Enter Madrasa ID first...</option>`;
      return;
    }

    loaderText.style.display = "block";
    
    try {
      // 1. Fetch Madrasa Name
      const snap = await getDoc(doc(db, "madrasas", mid));
      if(snap.exists()){
        mnameTitle.innerText = snap.data().name || "Madrasa Exam Result";
        mnameTitle.style.color = "#007bff";
      } else {
        mnameTitle.innerText = "Madrasa Not Found!";
        mnameTitle.style.color = "#dc3545";
        clsSelect.innerHTML = `<option value="">Invalid ID...</option>`;
        loaderText.style.display = "none";
        return;
      }

      // 2. Fetch Classes dynamically
      const q = query(collection(db, "madrasas", mid, "classes"), orderBy("createdAt"));
      const classSnap = await getDocs(q);
      
      let optionsHTML = `<option value="">Select your class</option>`;
      if(classSnap.empty) {
          optionsHTML = `<option value="">No classes found!</option>`;
      } else {
          classSnap.forEach(d => {
              optionsHTML += `<option value="${d.id}">${d.data().name}</option>`;
          });
      }
      clsSelect.innerHTML = optionsHTML;

    } catch(error) {
      console.error(error);
      mnameTitle.innerText = "Network Error!";
      mnameTitle.style.color = "#dc3545";
    }
    
    loaderText.style.display = "none";
  });

  // View Result Action
  document.getElementById("viewBtn").addEventListener("click", function() {
    const mid = document.getElementById("mid").value.trim();
    const cls = document.getElementById("cls").value;
    const reg = document.getElementById("reg").value.trim();

    if(mid === "" || cls === "" || reg === ""){
      alert("Please fill all details (Madrasa ID, Class, and Register No).");
      return;
    }

    // Redirect to Result Page
    window.location.href = `result.html?mid=${encodeURIComponent(mid)}&class=${encodeURIComponent(cls)}&reg=${encodeURIComponent(reg)}`;
  });

  // Admin Login Action
  document.getElementById("adminBtn").addEventListener("click", async function() {
    const mid = document.getElementById("mid").value.trim();
    const btn = document.getElementById("adminBtn");

    if(mid === ""){
      alert("Please enter Madrasa ID for Admin Login");
      return;
    }

    const originalText = btn.innerHTML;
    btn.innerHTML = `<i class="fas fa-spinner fa-spin"></i> Checking...`;
    btn.disabled = true;

    try {
      const snap = await getDoc(doc(db, "madrasas", mid));
      if(snap.exists()){
        window.location.href = `login.html?mid=${encodeURIComponent(mid)}`;
      } else {
        alert("Invalid Madrasa ID! (ഈ മദ്രസ ഐഡി നിലവിലില്ല)");
        btn.innerHTML = originalText;
        btn.disabled = false;
      }
    } catch(error) {
      alert("Network Error! Please check your connection.");
      btn.innerHTML = originalText;
      btn.disabled = false;
    }
  });

</script>

</body>
</html>